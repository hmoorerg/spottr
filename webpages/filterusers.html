<DOCTYPE Html>
    <head>
        <title>Find workout partners!</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    </head>
    <Body style="width: 90vw; margin: auto;text-align: center; padding: 1%">
        <h1>Filters : </h1>
        <!--City : <br /> -->
        <input id="txtCity" placeholder="City"/> <br/>
        <!--Age :  <br />-->    <br/>
        <input type="number" placeholder="Age" id="txtAge"/>
        <br />
        <br />
        Gender: <br/>
        <select id="comboGender" style="max-width:80vw;">
                <option value="A">Any</option> <br />
                <option value="M">Male</option>
                <option value="F">Female</option>
                <option value="O">Other</option>
            </select><br /><br />
        Prefered Workout times : <br />
        <select id="comboWorkoutTime" style="max-width:50%;">
                <option value="any time">Any</option>
                <option value="early morning">Early Morning (5am-8am)</option> <br />
                <option value="morning">Morning (8am-11am)</option>
                <option value="lunchtime">Lunchtime (8am-11am)</option>
                <option value="afternoon">Afternoon (11am-3pm)</option>
                <option value="evening">Evening (3pm-9pm)</option>
                <option value="night">Night (9pm-12am)</option>
                <option value="late night">Late Night (12am-5am)</option>
                
            </select>  <br />
            
            <br />
        
        <br />
        <h1>Here are some workout partners for you :  </h1>
        <div id="userList" style="line-height:2em;padding:20px;background-color: #FFF;border-style:solid;border-radius: 30px; font-size: 1.5em;">
            Users : <br/>
        </div>
        <script>
            var list = document.getElementById("userList")

            
            function filterUsers(user) {
                var shouldAddUser = true;


                var currentUsername = sessionStorage.getItem("name")
                if (currentUsername != null) {
                    if (currentUsername == user.name){
                        //Don't display current user
                        shouldAddUser = false;
                    }
                }

                var txtCity = document.getElementById("txtCity")
                if (txtCity.value != "") {
                var search = new RegExp(txtCity.value,'i')
                    if (!user.city.match(search))
                        shouldAddUser = false
                }
                
                var comboGender = document.getElementById("comboGender")
                if (comboGender.value != "A") {
                    if (user.gender != comboGender.value)
                        shouldAddUser = false
                }

                var comboWorkoutTime = document.getElementById("comboWorkoutTime")
                if (comboWorkoutTime.value != "any time") {
                    if (user.workoutTime != comboWorkoutTime.value)
                        shouldAddUser = false
                }

                var txtAge = document.getElementById("txtAge")
                if (txtAge.value != "") {
                    var search = new RegExp(txtAge.value,'i')
                    if (!user.age.toString().match(search))
                        shouldAddUser = false
                }
                
                return shouldAddUser

            }

            function printUserInfo(user){
                var prettyPrintGender = "O";
                switch (user.gender){
                    case "M" : prettyPrintGender = "male" 
                    break;
                    case "F" : prettyPrintGender = "female"
                    break;
                    case "O" : prettyPrintGender = "with no gender"
                }
                return user.name + " lives in " + user.city + " and is a " + user.age + " year old " + prettyPrintGender + " who works out at " + user.workoutTime
            }

            function updateList(){
                fetch('http://localhost:8080/getusers')
                    .then((data) => data.json())
                    .then((finishedData) => {
                        list.innerHTML = ""; // RESET INNER TEXT
                        var filteredData = finishedData.filter(filterUsers)
                        for (var i = 0; i < filteredData.length; i++) {
                            var person = filteredData[i]

                            list.innerHTML+= '<p>'+printUserInfo(person)+'</p><br />'
                        } 
                    });               
            }

            document.getElementById("txtCity").onkeydown = function (){
                updateList();
            }
            
            document.getElementById("comboGender").onchange = function (){
                updateList();
            }

            document.getElementById("comboWorkoutTime").onchange = function (){
                updateList();
            }

            document.getElementById("txtAge").onkeydown = function (){
                updateList();
            }

            document.addEventListener("DOMContentLoaded", function(event) { 
                updateList();
            });

        </script>
    </Body>
</DOCTYPE>